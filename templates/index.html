{% extends "base.html" %}

{% block title %}Z Framework DNA Analysis - Home{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 mx-auto">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h3 class="card-title mb-0">
                    <i class="fas fa-dna"></i> DNA Sequence Analysis
                </h3>
                <small class="text-light">Z Framework Empirical Proof System</small>
            </div>
            
            <div class="card-body">
                <div class="alert alert-info" role="alert">
                    <h5 class="alert-heading">Welcome to Z Framework DNA Analysis!</h5>
                    <p class="mb-0">
                        Enter a DNA sequence below to perform comprehensive spectral disruption analysis 
                        using the Z Framework's mathematical principles. The system provides empirical 
                        validation through convergence testing and optional CRISPR cross-validation.
                    </p>
                </div>

                <form method="POST" action="{{ url_for('analyze_sequence') }}" class="needs-validation" novalidate>
                    {{ form.hidden_tag() }}
                    
                    <!-- DNA Sequence Input -->
                    <div class="mb-4">
                        {{ form.sequence.label(class="form-label fw-bold") }}
                        {{ form.sequence(class="form-control" + (" is-invalid" if form.sequence.errors else "")) }}
                        {% if form.sequence.errors %}
                            <div class="invalid-feedback">
                                {% for error in form.sequence.errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}
                        <div class="form-text">{{ form.sequence.description }}</div>
                    </div>

                    <!-- Analysis Parameters -->
                    <div class="card border-light mb-4">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">Analysis Parameters</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    {{ form.precision.label(class="form-label") }}
                                    {{ form.precision(class="form-control" + (" is-invalid" if form.precision.errors else "")) }}
                                    {% if form.precision.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.precision.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                    <div class="form-text">{{ form.precision.description }}</div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    {{ form.window_size.label(class="form-label") }}
                                    {{ form.window_size(class="form-control" + (" is-invalid" if form.window_size.errors else "")) }}
                                    {% if form.window_size.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.window_size.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                    <div class="form-text">{{ form.window_size.description }}</div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    {{ form.num_perturbations.label(class="form-label") }}
                                    {{ form.num_perturbations(class="form-control" + (" is-invalid" if form.num_perturbations.errors else "")) }}
                                    {% if form.num_perturbations.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.num_perturbations.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                    <div class="form-text">{{ form.num_perturbations.description }}</div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    {{ form.perturbation_rate.label(class="form-label") }}
                                    {{ form.perturbation_rate(class="form-control" + (" is-invalid" if form.perturbation_rate.errors else "")) }}
                                    {% if form.perturbation_rate.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.perturbation_rate.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                    <div class="form-text">{{ form.perturbation_rate.description }}</div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check">
                                    {{ form.enable_crispr_validation(class="form-check-input") }}
                                    {{ form.enable_crispr_validation.label(class="form-check-label") }}
                                </div>
                                <div class="form-text">{{ form.enable_crispr_validation.description }}</div>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-calculator"></i> Analyze Sequence
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Quick Examples -->
        <div class="card mt-4 shadow-sm">
            <div class="card-header">
                <h5 class="mb-0">Quick Start Examples</h5>
            </div>
            <div class="card-body">
                <p class="text-muted">Try these example sequences to get started:</p>
                <div class="row">
                    <div class="col-md-6 mb-2">
                        <button class="btn btn-outline-secondary btn-sm w-100" 
                                onclick="fillSequence('ATGCTGCGGAGACCTGGAGAGAAAGCAGTGGCCGGGGCAGTGG')">
                            PCSK9 Example (Short)
                        </button>
                    </div>
                    <div class="col-md-6 mb-2">
                        <button class="btn btn-outline-secondary btn-sm w-100" 
                                onclick="fillSequence('GGCCGGCCGGCCGGCCATGCGCGCGCGCATGCCGGCCGGCCGGCC')">
                            High GC Content
                        </button>
                    </div>
                </div>
                <div class="text-center">
                    <a href="{{ url_for('examples') }}" class="btn btn-link">View All Examples</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function fillSequence(sequence) {
    document.querySelector('textarea[name="sequence"]').value = sequence;
}

// Check if there's a sequence to load from localStorage (from examples page)
document.addEventListener('DOMContentLoaded', function() {
    const savedSequence = localStorage.getItem('analysisSequence');
    if (savedSequence) {
        document.querySelector('textarea[name="sequence"]').value = savedSequence;
        localStorage.removeItem('analysisSequence');
        
        // Scroll to the sequence input
        document.querySelector('textarea[name="sequence"]').scrollIntoView({behavior: 'smooth'});
    }
});
</script>
{% endblock %}